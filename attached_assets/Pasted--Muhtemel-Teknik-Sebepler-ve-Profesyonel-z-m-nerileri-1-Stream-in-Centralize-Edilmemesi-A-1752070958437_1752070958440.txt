ğŸ” Muhtemel Teknik Sebepler (ve Profesyonel Ã‡Ã¶zÃ¼m Ã–nerileri)
1. âœ… Stream'in Centralize Edilmemesi (Ana AkÄ±ÅŸÄ±n Tek Kaynaktan YÃ¶netilmemesi)
Sorun:
Hem UserCameraView hem de HairAnalysisWidget kendi iÃ§inde kamera baÅŸlatmaya Ã§alÄ±ÅŸÄ±yor â†’ MediaStream Ã§akÄ±ÅŸmasÄ± + duplicate permission error riski.

Ã‡Ã¶zÃ¼m:
Kamera streamâ€™i sadece bir yerde (Ã¶rn: avatar-chat-widget.tsx) baÅŸlatÄ±n ve hem Ã¼st hem alt componentâ€™lere prop veya React Context ile verin. Ã–rnek Context setup:

tsx
Kopyala
DÃ¼zenle
const CameraContext = createContext<{ stream: MediaStream | null }>({ stream: null });
tsx
Kopyala
DÃ¼zenle
<CameraContext.Provider value={{ stream: videoStreamRef.current }}>
  <UserCameraView />
  <HairAnalysisWidget />
</CameraContext.Provider>
2. âœ… useEffect Timing Ã‡akÄ±ÅŸmasÄ±
Sorun:
HairAnalysisWidget bileÅŸeni mount oluyor ama streamReady hÃ¢lÃ¢ false. Bu yÃ¼zden â€œInitializing cameraâ€¦â€ mesajÄ± takÄ±lÄ± kalÄ±yor.

Ã‡Ã¶zÃ¼m:
streamReady deÄŸil, videoStreamRef.currentâ€™Ä±n null olup olmadÄ±ÄŸÄ±na gÃ¶re davranmak daha saÄŸlam bir yapÄ± kurar:

tsx
Kopyala
DÃ¼zenle
useEffect(() => {
  if (videoRef.current && videoStreamRef.current) {
    videoRef.current.srcObject = videoStreamRef.current;
    videoRef.current.play().catch(console.error);
  }
}, [videoStreamRef.current]); // veya sadece once run
Veya kontrolÃ¼ ÅŸu ÅŸekilde yap:

tsx
Kopyala
DÃ¼zenle
if (!videoStreamRef.current) return <div>Initializing camera...</div>
return <video ref={videoRef} autoPlay />
3. âœ… Camera Start Ä°ÅŸlemini Bir Utility Fonksiyona Ã‡ekin
Hair button clicked gibi eventâ€™lerde hem setCameraEnabled hem de getUserMedia Ã§aÄŸrÄ±sÄ± yapÄ±yorsanÄ±z, bunlarÄ± garanti altÄ±na alan bir utility fonksiyon kullanÄ±n:

tsx
Kopyala
DÃ¼zenle
async function ensureCameraReady() {
  if (!videoStreamRef.current) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      videoStreamRef.current = stream;
      setStreamReady(true);
    } catch (err) {
      console.error("Camera error:", err);
    }
  }
}
4. âœ… videoRef.current.srcObject HatasÄ±
Sorun: